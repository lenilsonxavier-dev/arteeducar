<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Pequenos Artistas ğŸ¨</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
<style>
/* ========== ESTILOS GLOBAIS ========== */
body {
  margin: 0;
  font-family: "Comic Sans MS", Arial, sans-serif;
  background: #fef6e4;
  text-align: center;
}
h1, h2 { color: #001858; }
.screen { display: none; padding: 10px; }
.active { display: block; }
button {
  padding: 14px; margin: 6px; border-radius: 16px; border: none;
  background: #f582ae; font-size: 16px; color: #001858; cursor: pointer;
  transition: 0.2s;
}
button:hover { background: #ff9cbb; }
.menu button { width: 80%; max-width: 320px; font-size: 18px; }
.canvas {
  border: 4px solid #001858; border-radius: 20px; background: white;
  touch-action: none; max-width: 100%; height: auto;
}
.tools button { background: #8bd3dd; }
.palette {
  display: flex; flex-wrap: wrap; justify-content: center; gap: 5px; margin: 10px 0;
}
.palette button {
  width: 40px; height: 40px; border-radius: 50%; border: 2px solid #001858;
  cursor: pointer;
}
.gallery {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
  margin: 20px 0;
}
.gallery img {
  width: 120px; height: 120px; object-fit: cover;
  margin: 6px; border-radius: 12px; border: 3px solid #001858;
}
.gallery-controls {
  margin: 20px 0;
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 10px;
}
.clear-gallery-btn {
  background: #ff6b6b;
  color: white;
  border: 2px solid #d32f2f;
}
.clear-gallery-btn:hover {
  background: #ff5252;
}
.card {
  background: #fff; border-radius: 20px; padding: 14px; margin: 12px; text-align: left;
  position: relative;
}
.card h3 { margin-top: 0; color: #172c66; }
.card .audio-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #8bd3dd;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.2s;
}
.card .audio-btn:hover {
  background: #f582ae;
  transform: scale(1.1);
}

/* ========== MURAL ========== */
.mural-container { max-width: 1200px; margin: 0 auto; padding: 10px; }
.mural-toolbar { display: flex; flex-wrap: wrap; justify-content: center; gap: 8px; margin: 20px 0; }
.mural-btn {
  background: #fff; border: 2px solid #8bd3dd; border-radius: 30px; padding: 8px 16px;
  font-size: 0.9rem; color: #001858; display: inline-flex; align-items: center; gap: 5px;
  cursor: pointer; transition: 0.2s;
}
.mural-btn:hover { background: #8bd3dd; }
.mural-btn.active { background: #f582ae; border-color: #f582ae; }
.upload-btn { background: #28a745; border-color: #28a745; color: white; }
.upload-btn:hover { background: #218838; }
.reset-btn { background: #ff6b6b; border-color: #ff6b6b; color: white; }
.reset-btn:hover { background: #ff5252; }
#file-input { display: none; }
.mural-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px;
  padding: 10px;
}
.mural-card {
  background: white; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  border: 2px solid #f582ae; position: relative;
}
.card-image {
  width: 100%; aspect-ratio: 1/1; background: #f3d2c1; display: flex; align-items: center;
  justify-content: center; overflow: hidden;
}
.card-image img { width: 100%; height: 100%; object-fit: cover; }
.card-label {
  padding: 8px; font-size: 0.85rem; background: #fef6e4; color: #001858;
  border-top: 1px solid #f582ae; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
}
.delete-btn {
  position: absolute; top: 5px; right: 5px; background: rgba(255,255,255,0.8);
  border: none; border-radius: 50%; width: 30px; height: 30px;
  font-size: 16px; cursor: pointer; color: #d32f2f;
  display: flex; align-items: center; justify-content: center;
  transition: 0.2s; z-index: 10;
}
.delete-btn:hover { background: white; transform: scale(1.1); }

/* ========== COLORIR ONLINE ========== */
.colorir-grid {
  display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 10px;
  margin: 20px 0; max-width: 600px; margin-left: auto; margin-right: auto;
}
.colorir-thumb {
  border: 3px solid #001858; border-radius: 12px; overflow: hidden; cursor: pointer;
  transition: 0.2s;
}
.colorir-thumb:hover { transform: scale(1.05); border-color: #f582ae; }
.colorir-thumb img { width: 100%; height: 100%; object-fit: cover; display: block; }
.colorir-tools { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin: 15px 0; }
.colorir-tools button { background: #8bd3dd; padding: 10px 20px; }
.selected-tool { background: #f582ae !important; color: white; }

/* ========== DESAFIOS DE ARTE ========== */
.desafios-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 10px;
}
.search-box {
  width: 100%;
  padding: 12px;
  margin: 20px 0;
  border: 2px solid #8bd3dd;
  border-radius: 30px;
  font-size: 16px;
  font-family: inherit;
}
.desafios-grid {
  display: grid;
  grid-template-columns: 1fr;
  gap: 20px;
  margin-top: 20px;
}
.desafio-card {
  background: white;
  border-radius: 20px;
  padding: 20px;
  text-align: left;
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  border-left: 8px solid #f582ae;
  position: relative;
}
.desafio-card h3 {
  color: #001858;
  margin-top: 0;
  font-size: 1.3rem;
  padding-right: 40px;
}
.desafio-card .numero {
  background: #f582ae;
  color: white;
  display: inline-block;
  padding: 5px 12px;
  border-radius: 20px;
  font-size: 0.9rem;
  margin-bottom: 10px;
}
.desafio-card .descricao {
  font-size: 1rem;
  margin: 10px 0;
  color: #172c66;
}
.desafio-card .objetivo {
  font-size: 0.95rem;
  color: #555;
  font-style: italic;
  border-top: 1px dashed #8bd3dd;
  padding-top: 10px;
}
.desafio-card .audio-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  background: #8bd3dd;
  border: none;
  border-radius: 50%;
  width: 40px;
  height: 40px;
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.2s;
}
.desafio-card .audio-btn:hover {
  background: #f582ae;
  transform: scale(1.1);
}
.random-btn {
  background: #8bd3dd;
  color: #001858;
  font-size: 1.2rem;
  padding: 12px 25px;
  margin-bottom: 20px;
}
.highlight {
  animation: pulse 1s ease-in-out;
}
@keyframes pulse {
  0% { transform: scale(1); background-color: #fff; }
  50% { transform: scale(1.02); background-color: #f9e6a2; }
  100% { transform: scale(1); background-color: #fff; }
}

/* ========== PINCEL MÃGICO ========== */
.pincel-container {
  max-width: 800px;
  margin: 0 auto;
  padding: 20px;
  background: #fff0e0;
  border-radius: 40px;
  box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}
.pincel-header {
  display: flex;
  align-items: center;
  gap: 15px;
  margin-bottom: 20px;
  background: #f8d5c4;
  padding: 15px 25px;
  border-radius: 60px;
}
.pincel-avatar {
  font-size: 70px;
  animation: tremer 2s infinite ease-in-out;
  filter: drop-shadow(2px 4px 6px rgba(0,0,0,0.2));
}
@keyframes tremer {
  0% { transform: rotate(0deg); }
  25% { transform: rotate(5deg); }
  50% { transform: rotate(-5deg); }
  75% { transform: rotate(3deg); }
  100% { transform: rotate(0deg); }
}
.pincel-fala {
  background: white;
  border-radius: 30px 30px 30px 5px;
  padding: 15px 20px;
  font-size: 1.2rem;
  color: #172c66;
  text-align: left;
  flex: 1;
  border: 2px solid #f582ae;
  position: relative;
}
.pincel-fala:before {
  content: '';
  position: absolute;
  left: -15px;
  top: 20px;
  width: 0;
  height: 0;
  border-top: 15px solid transparent;
  border-bottom: 15px solid transparent;
  border-right: 15px solid #f582ae;
}
.perguntas-sugeridas {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
  margin: 20px 0;
}
.perguntas-sugeridas button {
  background: #8bd3dd;
  font-size: 14px;
  padding: 8px 16px;
  border-radius: 40px;
  transition: 0.2s;
}
.perguntas-sugeridas button:hover {
  transform: scale(1.05);
  background: #f582ae;
}
.chat-area {
  background: #ffe9d6;
  border-radius: 30px;
  padding: 15px;
  max-height: 300px;
  overflow-y: auto;
  margin: 20px 0;
  border: 2px solid #f582ae;
  text-align: left;
}
.mensagem {
  margin: 10px 0;
  display: flex;
  align-items: flex-start;
  gap: 10px;
}
.mensagem.pergunta {
  justify-content: flex-end;
}
.mensagem.pergunta span {
  background: #f582ae;
  color: white;
  padding: 10px 15px;
  border-radius: 20px 20px 5px 20px;
  max-width: 70%;
  display: inline-block;
}
.mensagem.resposta {
  justify-content: flex-start;
  align-items: center;
}
.mensagem.resposta span {
  background: white;
  padding: 10px 15px;
  border-radius: 20px 20px 20px 5px;
  border: 2px solid #8bd3dd;
  max-width: 70%;
  display: inline-block;
}
.botao-audio {
  background: none;
  border: none;
  font-size: 20px;
  cursor: pointer;
  margin-left: 5px;
  padding: 5px;
  color: #172c66;
  transition: 0.2s;
}
.botao-audio:hover {
  transform: scale(1.2);
  color: #f582ae;
}
.input-area {
  display: flex;
  gap: 10px;
  margin-top: 15px;
}
.input-area input {
  flex: 1;
  padding: 15px;
  border: 3px solid #8bd3dd;
  border-radius: 50px;
  font-size: 16px;
  outline: none;
}
.input-area button {
  background: #f582ae;
  border-radius: 50px;
  padding: 15px 25px;
  font-size: 18px;
}
.modo-pais {
  background: #f8d5c4;
  border-radius: 30px;
  padding: 15px;
  margin-top: 20px;
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
  justify-content: center;
}
.modo-pais button {
  background: #172c66;
  color: white;
  font-size: 14px;
}

/* ========== DESENHO LIVRE (TOOLBAR SUPERIOR) ========== */
#toolbar { 
    background: white; padding: 15px; border-radius: 20px; box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    margin-bottom: 15px; display: flex; gap: 12px; flex-wrap: wrap; justify-content: center; max-width: 950px;
    margin-left: auto; margin-right: auto;
}
#toolbar .tool-group { display: flex; align-items: center; gap: 8px; border-right: 2px solid #eee; padding: 0 10px; }
#toolbar button { 
    padding: 8px 12px; cursor: pointer; border-radius: 10px; border: 1px solid #ddd;
    background: #f9f9f9; transition: 0.2s; font-size: 14px; margin: 0;
}
#toolbar button:hover { background: #eee; transform: scale(1.05); }
#toolbar button.active { background: #6c5ce7; color: white; }
#toolbar .btn-action { font-weight: bold; border: none; }
#toolbar .save { background: #2ecc71; color: white; }
#toolbar .clear { background: #e74c3c; color: white; }
#toolbar select, #toolbar input[type="range"] { cursor: pointer; }
#paintCanvas { 
    background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    cursor: url('https://cur.cursors-4u.net/games/gam-4/gam372.cur'), auto;
    touch-action: none; max-width: 100%; height: auto; display: block; margin: 0 auto;
    border: 4px solid #001858;
}
</style>
</head>
<body>

<!-- ========== MENU PRINCIPAL ========== -->
<div id="home" class="screen active menu">
  <h1>ğŸ¨ Pequenos Artistas</h1>
  <button onclick="show('desenho')">ğŸ– Desenho Livre</button>
  <button onclick="show('colorir')">ğŸ¨ Colorir Online</button>
  <button onclick="show('museu')">ğŸ› Museu Virtual</button>
  <button onclick="show('galeria')">ğŸ† Galeria</button>
  <button onclick="show('mural'); carregarMural()">ğŸ–¼ï¸ Mural Virtual</button>
  <button onclick="show('desafiosArte')">ğŸ² Desafios de Arte</button>
  <button onclick="show('pincelIA'); iniciarPincel()">ğŸ–Œ Pincel MÃ¡gico</button>
</div>

<!-- ========== DESENHO LIVRE (VERSÃƒO TOOLBAR SUPERIOR) ========== -->
<div id="desenho" class="screen">
  <h2>ğŸ– Super EstÃºdio de Desenho</h2>
  <div id="toolbar">
    <div class="tool-group">
        <input type="color" id="colorPicker" value="#6c5ce7">
        <input type="range" id="lineWidth" min="1" max="50" value="10">
    </div>
    <div class="tool-group">
        <select id="pincelEstilo">
            <option value="normal">ğŸ–Œï¸ Pincel Suave</option>
            <option value="spray">ğŸ’¨ Spray</option>
            <option value="giz">ğŸ–ï¸ Giz</option>
        </select>
        <button id="btnBorracha">ğŸ§½ Borracha</button>
        <button id="btnBalde">ğŸª£ Balde</button>
    </div>
    <div class="tool-group">
        <button id="btnRetangulo">ğŸŸ¦</button>
        <button id="btnCirculo">â­•</button>
        <button id="btnTriangulo">ğŸ”º</button>
        <button id="btnEstrela">â­</button>
        <button id="btnTexto">ğŸ“ Texto</button>
    </div>
    <button id="btnLimpar" class="btn-action clear">Limpar</button>
    <button id="btnSalvar" class="btn-action save">Salvar</button>
  </div>
  <canvas id="paintCanvas" width="900" height="550"></canvas>
  <button onclick="show('home')" style="margin-top:20px;">â¬… Voltar</button>
</div>

<!-- ========== COLORIR ONLINE ========== -->
<div id="colorir" class="screen">
  <h2>ğŸ¨ Colorir Online</h2>
  <p>Escolha um desenho:</p>
  <div class="colorir-grid" id="listaDesenhos"></div>
  
  <canvas id="canvasColorir" width="420" height="420" class="canvas" style="display:none;"></canvas>
  
  <div id="ferramentasColorir" style="display:none;">
    <div class="colorir-tools">
      <button id="btnPincel" class="selected-tool" onclick="setFerramenta('pincel')">ğŸ–Œ Pincel</button>
      <button id="btnBalde" onclick="setFerramenta('balde')">ğŸª£ Balde</button>
      <button onclick="limparCanvasColorir()">ğŸ§½ Limpar</button>
      <button onclick="salvarColorido()">ğŸ’¾ Salvar na Galeria</button>
      <button onclick="voltarEscolha()">â¬… Outro desenho</button>
    </div>
    <div class="palette" id="paletaCores"></div>
  </div>
  <button onclick="show('home')" style="margin-top:20px;">â¬… Voltar ao Menu</button>
</div>

<!-- ========== MUSEU VIRTUAL ========== -->
<div id="museu" class="screen">
  <h2>ğŸ› Museu Virtual</h2>
  <div class="card" id="card-portinari">
    <button class="audio-btn" onclick="lerTextoMusical('Candido Portinari pintava lembranÃ§as da sua infÃ¢ncia em Brodowski, mostrando crianÃ§as brincando, soltando pipa e jogando futebol. A obra Meninos no BalanÃ§o Ã© de 1960. O desafio Ã© desenhar crianÃ§as brincando no quintal.')">
      <i class="fas fa-volume-up"></i>
    </button>
    <h3>ğŸ¨ Candido Portinari (1903â€“1962)</h3>
    <p>Portinari pintava lembranÃ§as da sua infÃ¢ncia em Brodowski (SP), mostrando crianÃ§as brincando, soltando pipa e jogando futebol.</p>
    <p><strong>Meninos no BalanÃ§o (1960)</strong></p>
    <img src="https://i.imgur.com/VZH7ezB.jpg" style="max-width:200px">
    <p><strong>Desafio:</strong> desenhe crianÃ§as brincando no quintal.</p>
  </div>
  <div class="card" id="card-ivancruz">
    <button class="audio-btn" onclick="lerTextoMusical('Ivan Cruz ficou conhecido por retratar brincadeiras antigas como pular corda, amarelinha e aviÃ£ozinho. A obra Pular Corda mostra crianÃ§as brincando. O desafio Ã© desenhar uma brincadeira que vocÃª gosta.')">
      <i class="fas fa-volume-up"></i>
    </button>
    <h3>ğŸ¨ Ivan Cruz</h3>
    <p>Ivan Cruz ficou conhecido por retratar brincadeiras antigas como pular corda, amarelinha e aviÃ£ozinho.</p>
    <p><strong>Pular Corda</strong></p>
    <img src="https://i.imgur.com/nTjah0C.jpg" style="max-width:200px">
    <p><strong>Desafio:</strong> desenhe uma brincadeira que vocÃª gosta.</p>
  </div>
  <div class="card" id="card-britto">
    <button class="audio-btn" onclick="lerTextoMusical('Romero Britto usa muitas cores, linhas pretas e formas simples, criando obras alegres e divertidas. A obra CrianÃ§as Brincando Ã© um exemplo. O desafio Ã© desenhar usando muitas cores.')">
      <i class="fas fa-volume-up"></i>
    </button>
    <h3>ğŸ¨ Romero Britto</h3>
    <p>Romero Britto usa muitas cores, linhas pretas e formas simples, criando obras alegres e divertidas.</p>
    <p><strong>CrianÃ§as Brincando</strong></p>
    <img src="https://i.imgur.com/g9RiD8Q.jpg" style="max-width:200px">
    <p><strong>Desafio:</strong> desenhe usando muitas cores.</p>
  </div>
  <div class="card" id="card-tarsila">
    <button class="audio-btn" onclick="lerTextoMusical('Tarsila do Amaral utilizava cores vivas e formas grandes, ajudando a imaginar mundos diferentes no modernismo brasileiro. A obra Abaporu Ã© a mais famosa. O desafio Ã© criar um personagem bem diferente.')">
      <i class="fas fa-volume-up"></i>
    </button>
    <h3>ğŸ¨ Tarsila do Amaral (1886â€“1973)</h3>
    <p>Tarsila utilizava cores vivas e formas grandes, ajudando a imaginar mundos diferentes no modernismo brasileiro.</p>
    <p><strong>Abaporu</strong></p>
    <img src="https://i.imgur.com/Ai9sfV0.jpeg" style="max-width:200px">
    <p><strong>Desafio:</strong> crie um personagem bem diferente.</p>
  </div>
  <button onclick="show('home')">â¬… Voltar</button>
</div>

<!-- ========== GALERIA ========== -->
<div id="galeria" class="screen">
  <h2>ğŸ† Galeria dos Artistas</h2>
  <div class="gallery-controls">
    <button onclick="loadGallery()">ğŸ”„ Atualizar</button>
    <button class="clear-gallery-btn" onclick="limparGaleria()">ğŸ—‘ï¸ Limpar Galeria</button>
  </div>
  <div id="gallery" class="gallery"></div>
  <button onclick="show('home')">â¬… Voltar</button>
</div>

<!-- ========== MURAL VIRTUAL ========== -->
<div id="mural" class="screen">
  <h2>ğŸ–¼ï¸ Mural Virtual</h2>
  <div class="mural-container">
    <div class="mural-toolbar">
      <button class="mural-btn active" data-filter="todos"><i class="fas fa-images"></i> Todos</button>
      <button class="mural-btn" data-filter="uploads"><i class="fas fa-upload"></i> Uploads</button>
      <label for="file-input" class="mural-btn upload-btn"><i class="fas fa-cloud-upload-alt"></i> Enviar Imagem</label>
      <button class="mural-btn reset-btn" onclick="resetMural()"><i class="fas fa-trash-alt"></i> Limpar Mural</button>
      <input type="file" id="file-input" accept="image/*" multiple>
    </div>
    <div class="mural-grid" id="mural-grid"></div>
    <button onclick="show('home')" style="margin-top:20px;">â¬… Voltar</button>
  </div>
</div>

<!-- ========== DESAFIOS DE ARTE ========== -->
<div id="desafiosArte" class="screen">
  <h2>ğŸ² Desafios de Arte</h2>
  <div class="desafios-container">
    <button class="random-btn" onclick="sortearDesafio()">ğŸ² Desafio AleatÃ³rio</button>
    <input type="text" id="buscaDesafio" class="search-box" placeholder="ğŸ” Buscar desafio (ex: mÃºsica, colagem, teatro...)">
    <div id="desafiosGrid" class="desafios-grid"></div>
    <button onclick="show('home')" style="margin-top:20px;">â¬… Voltar</button>
  </div>
</div>

<!-- ========== TELA DO PINCEL MÃGICO ========== -->
<div id="pincelIA" class="screen">
  <h2>ğŸ–Œ Pincel MÃ¡gico</h2>
  <div class="pincel-container">
    <div class="pincel-header">
      <div class="pincel-avatar" id="pincelAvatar">ğŸ–Œï¸</div>
      <div class="pincel-fala" id="pincelFala">
        OlÃ¡! Eu sou o Pincel MÃ¡gico. Pode me perguntar sobre artistas, obras, me contar como se sente, ou pedir uma curiosidade!
        <button class="botao-audio" onclick="lerTexto('OlÃ¡! Eu sou o Pincel MÃ¡gico. Pode me perguntar sobre artistas, obras, me contar como se sente, ou pedir uma curiosidade!')">
          <i class="fas fa-volume-up"></i>
        </button>
      </div>
    </div>

    <div class="perguntas-sugeridas">
      <button onclick="fazerPergunta('Quem foi Leonardo da Vinci?')">Leonardo</button>
      <button onclick="fazerPergunta('Quem foi Van Gogh?')">Van Gogh</button>
      <button onclick="fazerPergunta('Quem foi Tarsila?')">Tarsila</button>
      <button onclick="fazerPergunta('Me conte uma curiosidade')">ğŸ¤” Curiosidade</button>
      <button onclick="fazerPergunta('O que Ã© som?')">ğŸµ Som</button>
      <button onclick="fazerPergunta('O que Ã© ritmo?')">ğŸ¥ Ritmo</button>
      <button onclick="fazerPergunta('Quem foi Mozart?')">ğŸ¼ Mozart</button>
      <button onclick="fazerPergunta('O que Ã© MPB?')">ğŸ‡§ğŸ‡· MPB</button>
      <button onclick="fazerPergunta('Estou triste')">ğŸ˜¢ Triste</button>
      <button onclick="fazerPergunta('Estou feliz')">ğŸ˜Š Feliz</button>
    </div>

    <div class="chat-area" id="chatArea">
      <!-- As mensagens aparecerÃ£o aqui -->
    </div>

    <div class="input-area">
      <input type="text" id="perguntaInput" placeholder="Digite sua pergunta ou como se sente...">
      <button onclick="enviarPergunta()">Enviar</button>
    </div>

    <!-- Modo Pais (simples) -->
    <div class="modo-pais">
      <button onclick="limparHistorico()">ğŸ§¹ Limpar histÃ³rico</button>
      <button onclick="bloquearPalavra()">ğŸš« Bloquear palavra</button>
      <span style="color:#172c66; font-size:14px;">(ex: "violÃªncia", "guerra")</span>
    </div>
  </div>
  <button onclick="show('home')" style="margin-top:20px;">â¬… Voltar ao Menu</button>
</div>

<script>
// ========== FUNÃ‡Ã•ES GLOBAIS ==========
function show(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
  if (id === "galeria") loadGallery();
  if (id === "desafiosArte") renderDesafios();
  if (id === "pincelIA") {
    const chat = document.getElementById('chatArea');
    if (chat.children.length === 0) {
      adicionarMensagem('resposta', 'OlÃ¡! Eu sou o Pincel MÃ¡gico. Pode me perguntar sobre artistas, obras, me contar como se sente, ou pedir uma curiosidade!');
    }
  }
}

// ========== FUNÃ‡ÃƒO DE ÃUDIO ==========
function lerTexto(texto) {
  const textoLimpo = texto.replace(/[^\w\s\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]/g, '');
  const utterance = new SpeechSynthesisUtterance(textoLimpo);
  utterance.lang = 'pt-BR';
  utterance.rate = 0.9;
  utterance.pitch = 1.2;
  window.speechSynthesis.speak(utterance);
}

function lerTextoMusical(texto) {
  lerTexto(texto);
}

// ========== DESENHO LIVRE (TOOLBAR SUPERIOR) ==========
const paintCanvas = document.getElementById('paintCanvas');
const paintCtx = paintCanvas.getContext('2d', { willReadFrequently: true });
const paintColorPicker = document.getElementById('colorPicker');
const paintLineWidth = document.getElementById('lineWidth');
const paintPincelEstilo = document.getElementById('pincelEstilo');

let paintDesenhando = false;
let paintFerramenta = 'normal';
let paintInicioX, paintInicioY;
let paintSnapshot;
let paintPontos = [];

function paintDefinirFerramenta(e, tipo) {
    document.querySelectorAll('#toolbar button').forEach(b => b.classList.remove('active'));
    if(e) e.target.classList.add('active');
    paintFerramenta = tipo;
}

function paintDesenharSuave(x, y) {
    paintPontos.push({ x, y });
    paintCtx.beginPath();
    paintCtx.lineCap = 'round';
    paintCtx.lineJoin = 'round';
    paintCtx.moveTo(paintPontos[0].x, paintPontos[0].y);
    for (let i = 1; i < paintPontos.length; i++) {
        const xc = (paintPontos[i].x + (paintPontos[i - 1]?.x || paintPontos[i].x)) / 2;
        const yc = (paintPontos[i].y + (paintPontos[i - 1]?.y || paintPontos[i].y)) / 2;
        paintCtx.quadraticCurveTo(paintPontos[i - 1].x, paintPontos[i - 1].y, xc, yc);
    }
    paintCtx.stroke();
}

function paintAplicarTextura(x, y) {
    if (paintFerramenta === 'spray') {
        for (let i = 0; i < 15; i++) {
            let off = paintLineWidth.value * 1.5;
            paintCtx.fillRect(x + (Math.random()-0.5)*off, y + (Math.random()-0.5)*off, 1, 1);
        }
    } else if (paintFerramenta === 'giz') {
        paintCtx.globalAlpha = 0.1;
        paintCtx.beginPath();
        paintCtx.arc(x, y, paintLineWidth.value/2, 0, Math.PI*2);
        paintCtx.fill();
        paintCtx.globalAlpha = 1;
    }
}

function paintDesenharForma(x, y) {
    paintCtx.beginPath();
    if (paintFerramenta === 'retangulo') {
        paintCtx.strokeRect(paintInicioX, paintInicioY, x - paintInicioX, y - paintInicioY);
    } else if (paintFerramenta === 'circulo') {
        let r = Math.sqrt(Math.pow(x - paintInicioX, 2) + Math.pow(y - paintInicioY, 2));
        paintCtx.arc(paintInicioX, paintInicioY, r, 0, Math.PI * 2);
        paintCtx.stroke();
    } else if (paintFerramenta === 'triangulo') {
        paintCtx.moveTo(paintInicioX + (x - paintInicioX) / 2, paintInicioY);
        paintCtx.lineTo(paintInicioX, y);
        paintCtx.lineTo(x, y);
        paintCtx.closePath();
        paintCtx.stroke();
    } else if (paintFerramenta === 'estrela') {
        paintDrawStar(paintInicioX, paintInicioY, Math.abs(x - paintInicioX), 5, 0.5);
    }
}

function paintDrawStar(cx, cy, r, p, m) {
    let rot = Math.PI / 2 * 3; let x = cx; let y = cy; let step = Math.PI / p;
    paintCtx.beginPath(); paintCtx.moveTo(cx, cy - r);
    for (let i = 0; i < p; i++) {
        x = cx + Math.cos(rot) * r; y = cy + Math.sin(rot) * r; paintCtx.lineTo(x, y); rot += step;
        x = cx + Math.cos(rot) * r * m; y = cy + Math.sin(rot) * r * m; paintCtx.lineTo(x, y); rot += step;
    }
    paintCtx.lineTo(cx, cy - r); paintCtx.closePath(); paintCtx.stroke();
}

function paintInserirTexto(x, y) {
    const txt = prompt("Escreva a sua mensagem:");
    if (txt) {
        let fontSize = Math.min(48, Math.max(12, paintLineWidth.value * 3));
        paintCtx.font = `${fontSize}px Comic Sans MS`;
        paintCtx.fillStyle = paintColorPicker.value;
        paintCtx.fillText(txt, x, y);
    }
}

function paintFloodFill(startX, startY, color) {
    const img = paintCtx.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
    const target = paintGetPixel(img, startX, startY);
    const fill = paintHexToRgb(color);
    if (paintMatch(target, fill)) return;
    const queue = [[startX, startY]];
    while (queue.length) {
        const [px, py] = queue.shift();
        if (paintMatch(paintGetPixel(img, px, py), target)) {
            paintSetPixel(img, px, py, fill);
            if (px > 0) queue.push([px - 1, py]);
            if (px < paintCanvas.width - 1) queue.push([px + 1, py]);
            if (py > 0) queue.push([px, py - 1]);
            if (py < paintCanvas.height - 1) queue.push([px, py + 1]);
        }
    }
    paintCtx.putImageData(img, 0, 0);
}

function paintGetPixel(img, x, y) {
    const i = (y * img.width + x) * 4;
    return [img.data[i], img.data[i+1], img.data[i+2]];
}
function paintSetPixel(img, x, y, c) {
    const i = (y * img.width + x) * 4;
    img.data[i]=c[0]; img.data[i+1]=c[1]; img.data[i+2]=c[2]; img.data[i+3]=255;
}
function paintHexToRgb(h) {
    return [parseInt(h.slice(1,3),16), parseInt(h.slice(3,5),16), parseInt(h.slice(5,7),16)];
}
function paintMatch(c1, c2) { return c1[0]===c2[0] && c1[1]===c2[1] && c1[2]===c2[2]; }

// Eventos de mouse
paintCanvas.addEventListener('mousedown', (e) => {
    paintDesenhando = true;
    paintInicioX = e.offsetX;
    paintInicioY = e.offsetY;
    paintPontos = [{ x: paintInicioX, y: paintInicioY }];
    paintSnapshot = paintCtx.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
    
    if (paintFerramenta === 'balde') paintFloodFill(paintInicioX, paintInicioY, paintColorPicker.value);
    if (paintFerramenta === 'texto') paintInserirTexto(paintInicioX, paintInicioY);
});

paintCanvas.addEventListener('mousemove', (e) => {
    if (!paintDesenhando || paintFerramenta === 'balde' || paintFerramenta === 'texto') return;
    
    const x = e.offsetX;
    const y = e.offsetY;
    paintCtx.lineWidth = paintLineWidth.value;
    paintCtx.strokeStyle = paintFerramenta === 'borracha' ? '#FFFFFF' : paintColorPicker.value;
    paintCtx.fillStyle = paintCtx.strokeStyle;

    if (paintFerramenta === 'normal' || paintFerramenta === 'borracha') {
        paintDesenharSuave(x, y);
    } else if (paintFerramenta === 'spray' || paintFerramenta === 'giz') {
        paintAplicarTextura(x, y);
    } else {
        paintCtx.putImageData(paintSnapshot, 0, 0);
        paintDesenharForma(x, y);
    }
});

paintCanvas.addEventListener('mouseup', () => {
    paintDesenhando = false;
    paintCtx.beginPath();
});

paintCanvas.addEventListener('mouseleave', () => {
    paintDesenhando = false;
});

// Eventos de toque
paintCanvas.addEventListener('touchstart', (e) => {
    e.preventDefault();
    const rect = paintCanvas.getBoundingClientRect();
    const touch = e.touches[0];
    const x = touch.clientX - rect.left;
    const y = touch.clientY - rect.top;
    paintDesenhando = true;
    paintInicioX = x;
    paintInicioY = y;
    paintPontos = [{ x, y }];
    paintSnapshot = paintCtx.getImageData(0, 0, paintCanvas.width, paintCanvas.height);
    if (paintFerramenta === 'balde') paintFloodFill(x, y, paintColorPicker.value);
    if (paintFerramenta === 'texto') paintInserirTexto(x, y);
});

paintCanvas.addEventListener('touchmove', (e) => {
    e.preventDefault();
    if (!paintDesenhando || paintFerramenta === 'balde' || paintFerramenta === 'texto') return;
    const rect = paintCanvas.getBoundingClientRect();
    const touch = e.touches[0];
    const x = touch.clientX - rect.left;
    const y = touch.clientY - rect.top;
    paintCtx.lineWidth = paintLineWidth.value;
    paintCtx.strokeStyle = paintFerramenta === 'borracha' ? '#FFFFFF' : paintColorPicker.value;
    paintCtx.fillStyle = paintCtx.strokeStyle;
    if (paintFerramenta === 'normal' || paintFerramenta === 'borracha') {
        paintDesenharSuave(x, y);
    } else if (paintFerramenta === 'spray' || paintFerramenta === 'giz') {
        paintAplicarTextura(x, y);
    } else {
        paintCtx.putImageData(paintSnapshot, 0, 0);
        paintDesenharForma(x, y);
    }
});

paintCanvas.addEventListener('touchend', (e) => {
    e.preventDefault();
    paintDesenhando = false;
    paintCtx.beginPath();
});

// ConfiguraÃ§Ã£o dos botÃµes da toolbar
document.getElementById('btnBorracha').onclick = (e) => paintDefinirFerramenta(e, 'borracha');
document.getElementById('btnBalde').onclick = (e) => paintDefinirFerramenta(e, 'balde');
document.getElementById('btnRetangulo').onclick = (e) => paintDefinirFerramenta(e, 'retangulo');
document.getElementById('btnCirculo').onclick = (e) => paintDefinirFerramenta(e, 'circulo');
document.getElementById('btnTriangulo').onclick = (e) => paintDefinirFerramenta(e, 'triangulo');
document.getElementById('btnEstrela').onclick = (e) => paintDefinirFerramenta(e, 'estrela');
document.getElementById('btnTexto').onclick = (e) => paintDefinirFerramenta(e, 'texto');
paintPincelEstilo.onchange = () => paintDefinirFerramenta(null, paintPincelEstilo.value);

// FunÃ§Ãµes de salvar e limpar
window.saveDrawing = function() {
    const data = paintCanvas.toDataURL();
    const imgs = JSON.parse(localStorage.getItem("arts") || "[]");
    imgs.push(data);
    localStorage.setItem("arts", JSON.stringify(imgs));
    alert("ğŸ‰ Desenho salvo na Galeria!");
};

window.clearCanvas = function() {
    paintCtx.clearRect(0, 0, paintCanvas.width, paintCanvas.height);
};

document.getElementById('btnLimpar').onclick = clearCanvas;
document.getElementById('btnSalvar').onclick = saveDrawing;

// Inicializa ferramenta padrÃ£o
paintFerramenta = 'normal';

// ========== COLORIR ONLINE ==========
const imagensColorir = [
  "https://i.imgur.com/Q6oaW2D.jpg",
  "https://i.imgur.com/of23VQu.jpg",
  "https://i.imgur.com/6JfY8vS.jpg",
  "https://i.imgur.com/tSKRiM6.jpg",
  "https://i.imgur.com/Tb4CYtP.jpg",
  "https://i.imgur.com/97YWE9f.jpg",
  "https://i.imgur.com/3NTWOok.jpg",
  "https://i.imgur.com/UpY3Zy0.jpg",
  "https://i.imgur.com/XaxtQyn.jpg"
];

const listaDesenhos = document.getElementById("listaDesenhos");
const canvasColorir = document.getElementById("canvasColorir");
const ctxColorir = canvasColorir.getContext("2d");
const ferramentasColorir = document.getElementById("ferramentasColorir");
let ferramentaAtual = "pincel";
let corAtual = "#ff0000";
let drawing = false;
let size = 6;

// Miniaturas
imagensColorir.forEach((url, index) => {
  const div = document.createElement("div");
  div.className = "colorir-thumb";
  div.innerHTML = `<img src="${url}" alt="Desenho ${index+1}" onclick="carregarDesenho('${url}')">`;
  listaDesenhos.appendChild(div);
});

// Paleta de cores
const cores = [
  "#ff0000", "#00ff00", "#0000ff", "#ffff00", "#ff00ff", "#00ffff",
  "#ff8800", "#8800ff", "#0088ff", "#ff0088", "#88ff00", "#000000"
];
const paletaCores = document.getElementById("paletaCores");
cores.forEach(c => {
  const btn = document.createElement("button");
  btn.style.background = c;
  btn.onclick = () => corAtual = c;
  paletaCores.appendChild(btn);
});

function carregarDesenho(url) {
  listaDesenhos.style.display = "none";
  canvasColorir.style.display = "block";
  ferramentasColorir.style.display = "block";
  
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = url;
  img.onload = () => {
    ctxColorir.clearRect(0, 0, canvasColorir.width, canvasColorir.height);
    ctxColorir.drawImage(img, 0, 0, canvasColorir.width, canvasColorir.height);
  };
  img.onerror = () => {
    alert("Erro ao carregar a imagem. Verifique a URL ou use imagens locais.");
    voltarEscolha();
  };
}

function setFerramenta(ferr) {
  ferramentaAtual = ferr;
  document.getElementById("btnPincel").classList.toggle("selected-tool", ferr === "pincel");
  document.getElementById("btnBalde").classList.toggle("selected-tool", ferr === "balde");
}

// Flood fill para colorir
function floodFill(x, y, fillColor) {
  const imageData = ctxColorir.getImageData(0, 0, canvasColorir.width, canvasColorir.height);
  const data = imageData.data;
  const targetColor = getPixelColor(data, x, y);
  const fillRgb = hexToRgb(fillColor);
  
  if (colorMatch(targetColor, fillRgb)) return;
  
  const pixelsToCheck = [[x, y]];
  while (pixelsToCheck.length) {
    const [cx, cy] = pixelsToCheck.pop();
    const idx = (cy * canvasColorir.width + cx) * 4;
    if (!colorMatch([data[idx], data[idx+1], data[idx+2]], targetColor)) continue;
    
    data[idx] = fillRgb[0];
    data[idx+1] = fillRgb[1];
    data[idx+2] = fillRgb[2];
    data[idx+3] = 255;
    
    if (cx > 0) pixelsToCheck.push([cx-1, cy]);
    if (cx < canvasColorir.width-1) pixelsToCheck.push([cx+1, cy]);
    if (cy > 0) pixelsToCheck.push([cx, cy-1]);
    if (cy < canvasColorir.height-1) pixelsToCheck.push([cx, cy+1]);
  }
  ctxColorir.putImageData(imageData, 0, 0);
}

function getPixelColor(data, x, y) {
  const idx = (y * canvasColorir.width + x) * 4;
  return [data[idx], data[idx+1], data[idx+2]];
}

function colorMatch(rgb1, rgb2) {
  return rgb1[0] === rgb2[0] && rgb1[1] === rgb2[1] && rgb1[2] === rgb2[2];
}

function hexToRgb(hex) {
  const r = parseInt(hex.slice(1,3), 16);
  const g = parseInt(hex.slice(3,5), 16);
  const b = parseInt(hex.slice(5,7), 16);
  return [r, g, b];
}

canvasColorir.onpointerdown = (e) => {
  const rect = canvasColorir.getBoundingClientRect();
  const scaleX = canvasColorir.width / rect.width;
  const scaleY = canvasColorir.height / rect.height;
  const x = Math.floor((e.clientX - rect.left) * scaleX);
  const y = Math.floor((e.clientY - rect.top) * scaleY);
  
  if (ferramentaAtual === "balde") {
    floodFill(x, y, corAtual);
  } else {
    drawing = true;
  }
};

canvasColorir.onpointermove = (e) => {
  if (!drawing || ferramentaAtual !== "pincel") return;
  const rect = canvasColorir.getBoundingClientRect();
  const scaleX = canvasColorir.width / rect.width;
  const scaleY = canvasColorir.height / rect.height;
  const x = Math.floor((e.clientX - rect.left) * scaleX);
  const y = Math.floor((e.clientY - rect.top) * scaleY);
  
  ctxColorir.fillStyle = corAtual;
  ctxColorir.beginPath();
  ctxColorir.arc(x, y, size, 0, Math.PI * 2);
  ctxColorir.fill();
};

canvasColorir.onpointerup = () => { drawing = false; };
canvasColorir.onpointerleave = () => { drawing = false; };

function limparCanvasColorir() {
  ctxColorir.clearRect(0, 0, canvasColorir.width, canvasColorir.height);
}

function salvarColorido() {
  const data = canvasColorir.toDataURL();
  const imgs = JSON.parse(localStorage.getItem("arts") || "[]");
  imgs.push(data);
  localStorage.setItem("arts", JSON.stringify(imgs));
  alert("ğŸ‰ Desenho colorido salvo na Galeria!");
}

function voltarEscolha() {
  listaDesenhos.style.display = "grid";
  canvasColorir.style.display = "none";
  ferramentasColorir.style.display = "none";
  limparCanvasColorir();
}

// ========== GALERIA ==========
function loadGallery() {
  const gallery = document.getElementById("gallery");
  gallery.innerHTML = "";
  const imgs = JSON.parse(localStorage.getItem("arts") || "[]");
  if (imgs.length === 0) {
    gallery.innerHTML = '<p style="padding:40px;">Nenhum desenho na galeria ainda ğŸ¨</p>';
  } else {
    imgs.forEach(i => {
      const img = document.createElement("img");
      img.src = i;
      gallery.appendChild(img);
    });
  }
}

function limparGaleria() {
  if (confirm('Tem certeza que deseja apagar TODOS os desenhos da galeria?')) {
    localStorage.removeItem("arts");
    loadGallery();
    alert('Galeria limpa! ğŸ§¹');
  }
}

// ========== MURAL VIRTUAL ==========
let savedUploads = JSON.parse(localStorage.getItem("muralUploads") || "[]");
let muralItems = [...savedUploads];

const muralGrid = document.getElementById("mural-grid");
const filterButtons = document.querySelectorAll('.mural-btn[data-filter]');
const fileInput = document.getElementById('file-input');
let currentFilter = 'todos';

function renderMural() {
  let filtered = currentFilter === 'todos' ? muralItems : muralItems.filter(i => i.category === 'upload');
  let html = '';
  filtered.forEach(item => {
    html += `
      <div class="mural-card" data-id="${item.id}">
        <div class="card-image"><img src="${item.imageUrl}" alt="${item.label}"></div>
        <button class="delete-btn" data-id="${item.id}" title="Apagar imagem">
          <i class="fas fa-trash-alt"></i>
        </button>
        <div class="card-label" title="${item.label}">${item.label}</div>
      </div>
    `;
  });
  if (filtered.length === 0) html = '<div style="grid-column:1/-1; padding:30px;">Nenhuma imagem ainda ğŸ–¼ï¸</div>';
  muralGrid.innerHTML = html;
}

function deletarImagem(id) {
  muralItems = muralItems.filter(item => item.id !== id);
  savedUploads = savedUploads.filter(item => item.id !== id);
  localStorage.setItem("muralUploads", JSON.stringify(savedUploads));
  renderMural();
}

muralGrid.addEventListener('click', (e) => {
  const deleteBtn = e.target.closest('.delete-btn');
  if (!deleteBtn) return;
  const card = deleteBtn.closest('.mural-card');
  if (!card) return;
  const id = card.dataset.id;
  if (id) deletarImagem(id);
});

window.resetMural = function() {
  if (confirm('Tem certeza que deseja apagar TODAS as imagens do mural?')) {
    localStorage.removeItem('muralUploads');
    savedUploads = [];
    muralItems = [];
    renderMural();
    setActiveFilterButton('todos');
    currentFilter = 'todos';
  }
};

function setActiveFilterButton(filter) {
  filterButtons.forEach(btn => {
    btn.classList.toggle('active', btn.getAttribute('data-filter') === filter);
  });
}

filterButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    currentFilter = btn.getAttribute('data-filter');
    setActiveFilterButton(currentFilter);
    renderMural();
  });
});

fileInput.addEventListener('change', (e) => {
  Array.from(e.target.files).forEach(file => {
    if (!file.type.startsWith('image/')) return;
    const reader = new FileReader();
    reader.onload = (event) => {
      const uniqueId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
      const newItem = {
        id: uniqueId,
        label: file.name.length > 20 ? file.name.substr(0,20)+'â€¦' : file.name,
        category: 'upload',
        imageUrl: event.target.result
      };
      muralItems.push(newItem);
      savedUploads.push(newItem);
      localStorage.setItem("muralUploads", JSON.stringify(savedUploads));
      if (currentFilter === 'uploads' || currentFilter === 'todos') renderMural();
    };
    reader.readAsDataURL(file);
  });
  fileInput.value = '';
});

function carregarMural() {
  savedUploads = JSON.parse(localStorage.getItem("muralUploads") || "[]");
  muralItems = [...savedUploads];
  renderMural();
  setActiveFilterButton('todos');
  currentFilter = 'todos';
}

// ========== DESAFIOS DE ARTE ==========
const desafios = [
  { 
    numero: 1, 
    titulo: "Desenho Ã s Cegas", 
    descricao: "Cada aluno fecha os olhos e tenta desenhar um objeto simples (copo, casa, flor). Depois comparam os resultados, rindo e discutindo sobre formas e proporÃ§Ãµes.", 
    objetivo: "estimular criatividade e percepÃ§Ã£o sem pressÃ£o estÃ©tica." 
  },
  { 
    numero: 2, 
    titulo: "Cores Musicais", 
    descricao: "O professor coloca mÃºsicas diferentes (alegre, triste, calma, agitada). Os alunos devem pintar ou desenhar o que 'sentirem' com cada mÃºsica.", 
    objetivo: "trabalhar expressÃ£o artÃ­stica e relaÃ§Ã£o entre som e cor." 
  },
  { 
    numero: 150, 
    titulo: "ExposiÃ§Ã£o de Arte da Turma", 
    descricao: "Organizar uma exposiÃ§Ã£o com os melhores trabalhos do ano, cada aluno explica sua obra.", 
    objetivo: "valorizar o processo criativo e desenvolver autoconfianÃ§a." 
  }
];

function renderDesafios() {
  const busca = document.getElementById('buscaDesafio').value.toLowerCase();
  const grid = document.getElementById('desafiosGrid');
  const filtrados = desafios.filter(d => 
    d.titulo.toLowerCase().includes(busca) || 
    d.descricao.toLowerCase().includes(busca) || 
    d.objetivo.toLowerCase().includes(busca)
  );
  
  let html = '';
  filtrados.forEach(d => {
    const textoCompleto = `Desafio nÃºmero ${d.numero}: ${d.titulo}. ${d.descricao} Objetivo: ${d.objetivo}`;
    html += `
      <div class="desafio-card" id="desafio-${d.numero}">
        <button class="audio-btn" onclick="lerTexto('${textoCompleto.replace(/'/g, "\\'")}')">
          <i class="fas fa-volume-up"></i>
        </button>
        <span class="numero">#${d.numero}</span>
        <h3>${d.titulo}</h3>
        <div class="descricao">${d.descricao}</div>
        <div class="objetivo"><strong>Objetivo:</strong> ${d.objetivo}</div>
      </div>
    `;
  });
  if (filtrados.length === 0) {
    html = '<p style="text-align:center; padding:40px;">Nenhum desafio encontrado ğŸ˜•</p>';
  }
  grid.innerHTML = html;
}

document.getElementById('buscaDesafio')?.addEventListener('input', renderDesafios);

window.sortearDesafio = function() {
  const randomIndex = Math.floor(Math.random() * desafios.length);
  const sorteado = desafios[randomIndex];
  const elemento = document.getElementById(`desafio-${sorteado.numero}`);
  if (elemento) {
    elemento.scrollIntoView({ behavior: 'smooth', block: 'center' });
    elemento.classList.add('highlight');
    setTimeout(() => elemento.classList.remove('highlight'), 1500);
  } else {
    document.getElementById('buscaDesafio').value = '';
    renderDesafios();
    setTimeout(() => {
      const el = document.getElementById(`desafio-${sorteado.numero}`);
      if (el) {
        el.scrollIntoView({ behavior: 'smooth', block: 'center' });
        el.classList.add('highlight');
        setTimeout(() => el.classList.remove('highlight'), 1500);
      }
    }, 100);
  }
};

// ========== PINCEL MÃGICO - BANCO DE CONHECIMENTO EXPANDIDO ==========
// Atividades emocionais
const atividadesTriste = [
  "Sinto muito que vocÃª esteja se sentindo triste. ğŸ’™ Vamos transformar essa tristeza em arte? Desenhe um coraÃ§Ã£o e imagine o que ele gostaria de dizer.",
  "Que pena que vocÃª estÃ¡ triste. â˜” Que tal fazer a DanÃ§a da Chuva Leve? FaÃ§a movimentos bem lentos, como se seus braÃ§os fossem gotinhas caindo do cÃ©u."
];
const atividadesFeliz = [
  "Que bom que vocÃª estÃ¡ feliz! ğŸ’ƒ Vamos espalhar essa alegria? Dance pela sala fazendo movimentos bem grandes, abrindo os braÃ§os e ocupando todo o espaÃ§o.",
  "Alegria combina com mÃºsica animada! ğŸ¨ Escute sua mÃºsica preferida e desenhe o que ela te faz sentir."
];
const atividadesTedio = [
  "Ah, tÃ©dio! ğŸ¦„ Vamos inventar um animal que nÃ£o existe e danÃ§ar como ele? Pode ser um 'elefante voador' ou um 'cachorro com asas'!"
];
const atividadesAnsioso = [
  "A ansiedade pode ser difÃ­cil, mas vocÃª consegue superar! ğŸˆ Vamos fazer a RespiraÃ§Ã£o do BalÃ£o? Inspire enchendo a barriga como se fosse um balÃ£o e expire esvaziando bem devagar."
];
const atividadesRaiva = [
  "A raiva Ã© forte, mas vocÃª Ã© mais forte ainda! ğŸ˜¤ Vamos transformar essa raiva em arte. Desenhe sua raiva e depois rasgue o papel bem forte."
];

// Conceitos musicais
const conceitosMusicais = [
  { palavras: ['som', 'o que Ã© som'], resposta: 'ğŸµ Som Ã© tudo o que podemos ouvir. O silÃªncio tambÃ©m faz parte da mÃºsica, ele ajuda o som a â€œrespirarâ€.' },
  { palavras: ['altura do som', 'som agudo', 'som grave'], resposta: 'ğŸµ Som agudo Ã© fininho e alto, como o canto de um passarinho ğŸ¦. Som grave Ã© grosso e forte, como um tambor ğŸ¥.' },
  { palavras: ['intensidade', 'volume', 'som forte', 'som fraco'], resposta: 'ğŸµ Intensidade Ã© o volume do som: forte Ã© o som alto; fraco Ã© o som baixinho. A mÃºsica pode crescer e diminuir como uma onda ğŸŒŠ.' },
  { palavras: ['duraÃ§Ã£o', 'sons curtos', 'sons longos'], resposta: 'ğŸµ DuraÃ§Ã£o Ã© quanto tempo um som dura. Sons curtos e longos juntos criam o ritmo da mÃºsica.' },
  { palavras: ['ritmo', 'o que Ã© ritmo'], resposta: 'ğŸµ Ritmo Ã© o coraÃ§Ã£o da mÃºsica ğŸ’“. Acontece quando batemos palmas, pÃ©s ou acompanhamos uma canÃ§Ã£o.' },
  { palavras: ['melodia', 'o que Ã© melodia'], resposta: 'ğŸµ Melodia Ã© a linha musical que cantamos ğŸ¶. Ã‰ aquela parte da mÃºsica que fica na cabeÃ§a o dia todo.' },
  { palavras: ['instrumentos musicais', 'tipos de instrumentos'], resposta: 'ğŸµ Instrumentos musicais: sopro (flauta, trompete), cordas (violÃ£o, violino), percussÃ£o (tambor, pandeiro). Cada instrumento tem sua voz especial.' },
  { palavras: ['mÃºsica Ã© expressÃ£o'], resposta: 'ğŸµ A mÃºsica pode mostrar alegria, tristeza, calma ou energia ğŸ˜ŠğŸ˜¢. NÃ£o precisa falar para comunicar!' },
];

// Compositores clÃ¡ssicos
const compositores = [
  { palavras: ['idade mÃ©dia', 'mÃºsica medieval', 'hildegard von bingen'], resposta: 'ğŸ¶ Na Idade MÃ©dia (sÃ©c. Vâ€“XV), a mÃºsica era ligada Ã  igreja, cantada em grupo, sem instrumentos. Hildegard von Bingen foi uma monja compositora e pensadora. Obra famosa: Ordo Virtutum.' },
  { palavras: ['renascimento', 'mÃºsica renascentista', 'palestrina'], resposta: 'ğŸ¶ No Renascimento (sÃ©c. XVâ€“XVI), a mÃºsica ficou mais suave, com vÃ¡rias vozes juntas. Giovanni Pierluigi da Palestrina foi um compositor italiano de mÃºsica sacra. Obra famosa: Missa Papae Marcelli.' },
  { palavras: ['barroco', 'bach', 'vivaldi'], resposta: 'ğŸ¶ O perÃ­odo Barroco (1600â€“1750) tem mÃºsica cheia de emoÃ§Ã£o e contrastes. Johann Sebastian Bach foi um mestre alemÃ£o da harmonia. Obra: Toccata e Fuga. Antonio Vivaldi, italiano, criou As Quatro EstaÃ§Ãµes.' },
  { palavras: ['clÃ¡ssico', 'mozart', 'haydn'], resposta: 'ğŸ¶ No perÃ­odo ClÃ¡ssico (1750â€“1820), a mÃºsica Ã© equilibrada e clara. Wolfgang Amadeus Mozart foi um gÃªnio desde crianÃ§a. Obra: Eine kleine Nachtmusik. Joseph Haydn, austrÃ­aco, compÃ´s a Sinfonia Surpresa.' },
  { palavras: ['romÃ¢ntico', 'beethoven', 'chopin'], resposta: 'ğŸ¶ O Romantismo (sÃ©c. XIX) trouxe mÃºsica intensa e cheia de sentimentos. Ludwig van Beethoven revolucionou a mÃºsica mesmo surdo. Obra: Sinfonia nÂº 9. FrÃ©dÃ©ric Chopin, polonÃªs, criou os Noturnos.' },
  { palavras: ['moderno', 'debussy'], resposta: 'ğŸ¶ Na mÃºsica moderna (sÃ©c. XX), Claude Debussy, francÃªs, criou mÃºsicas como pinturas sonoras. Obra: Clair de Lune.' },
  { palavras: ['resumo perÃ­odos musicais'], resposta: 'âœ¨ Resumo rÃ¡pido: Idade MÃ©dia: mÃºsica religiosa; Renascimento: harmonia vocal; Barroco: emoÃ§Ã£o e movimento; ClÃ¡ssico: equilÃ­brio e clareza; RomÃ¢ntico: sentimento e drama; Moderno: experimentaÃ§Ã£o.' },
];

// MÃºsica infantil
const musicaInfantil = [
  { palavras: ['palavra cantada'], resposta: 'ğŸ§¸ A Palavra Cantada Ã© a dupla Sandra Peres e Paulo Tatit, que faz mÃºsicas educativas, poÃ©ticas e divertidas para crianÃ§as.' },
  { palavras: ['toquinho'], resposta: 'ğŸ§¸ Toquinho Ã© um cantor e compositor brasileiro com canÃ§Ãµes suaves e afetivas que encantam crianÃ§as e adultos.' },
  { palavras: ['bia bedran'], resposta: 'ğŸ§¸ Bia Bedran traz brincadeiras cantadas, folclore e histÃ³rias, com forte ligaÃ§Ã£o com a educaÃ§Ã£o infantil.' },
  { palavras: ['hÃ©lio ziskind'], resposta: 'ğŸ§¸ HÃ©lio Ziskind Ã© conhecido por canÃ§Ãµes educativas e trilhas infantis para TV.' },
  { palavras: ['xuxa'], resposta: 'ğŸ§¸ Xuxa Ã© um Ã­cone do pop infantil, com coreografias, cores e refrÃµes fÃ¡ceis que marcaram Ã©poca.' },
  { palavras: ['tiquequÃª'], resposta: 'ğŸ§¸ TiquequÃª Ã© um grupo com humor, jogos de palavras e criatividade.' },
  { palavras: ['the wiggles'], resposta: 'ğŸ§¸ The Wiggles Ã© um grupo australiano que une mÃºsica e danÃ§a para aprender brincando.' },
  { palavras: ['raffi'], resposta: 'ğŸ§¸ Raffi Ã© um cantor de folk infantil com mensagens de respeito, natureza e amizade.' },
  { palavras: ['disney'], resposta: 'ğŸ§¸ As mÃºsicas da Disney sÃ£o trilhas sonoras de filmes que encantam com histÃ³rias, emoÃ§Ã£o e canÃ§Ãµes inesquecÃ­veis.' },
];

// GÃªneros musicais
const generosMusicais = [
  { palavras: ['mpb', 'mÃºsica popular brasileira'], resposta: 'ğŸ‡§ğŸ‡· MPB mistura tradiÃ§Ã£o e modernidade. Letras poÃ©ticas, sociais e afetivas. Usa violÃ£o, piano e ritmos brasileiros.' },
  { palavras: ['funk'], resposta: 'ğŸ¤ Funk tem batida forte e repetitiva. Surgiu nas periferias como forma de expressÃ£o social e danÃ§a.' },
  { palavras: ['pop'], resposta: 'ğŸ¤ Pop Ã© mÃºsica popular e acessÃ­vel, com refrÃµes fÃ¡ceis e ritmo danÃ§ante.' },
  { palavras: ['rock'], resposta: 'ğŸ¤ Rock tem energia, atitude e guitarras elÃ©tricas. Fala de liberdade e juventude.' },
  { palavras: ['samba'], resposta: 'ğŸ‡§ğŸ‡· Samba Ã© ritmo brasileiro ligado Ã  danÃ§a e Ã  comunidade. Usa percussÃ£o e alegria.' },
  { palavras: ['bossa nova'], resposta: 'ğŸ‡§ğŸ‡· Bossa nova Ã© um samba mais suave e sofisticado, com clima calmo e violÃ£o delicado.' },
  { palavras: ['axÃ©'], resposta: 'ğŸ¤ AxÃ© Ã© ritmo festivo da Bahia, para danÃ§ar, pular e cantar em grupo.' },
  { palavras: ['forrÃ³'], resposta: 'ğŸ¤ ForrÃ³ Ã© ritmo nordestino animado ou romÃ¢ntico, com sanfona, zabumba e triÃ¢ngulo.' },
  { palavras: ['blues'], resposta: 'ğŸ¤ Blues Ã© mÃºsica de sentimento profundo, que fala de tristeza, esperanÃ§a e vida.' },
  { palavras: ['jazz'], resposta: 'ğŸ¤ Jazz Ã© improvisaÃ§Ã£o e liberdade musical. Cada mÃºsico cria no momento.' },
  { palavras: ['reggae'], resposta: 'ğŸ¤ Reggae tem ritmo tranquilo e marcado, com mensagens de paz, amor e igualdade.' },
  { palavras: ['heavy metal'], resposta: 'ğŸ¤ Heavy metal Ã© a versÃ£o mais pesada do rock, com guitarras distorcidas e temas intensos.' },
  { palavras: ['house'], resposta: 'ğŸ¤ House Ã© mÃºsica eletrÃ´nica danÃ§ante, com batida constante.' },
  { palavras: ['techno', 'tecno'], resposta: 'ğŸ¤ Techno Ã© eletrÃ´nica mais minimalista e futurista, com sons repetidos.' },
  { palavras: ['hip hop'], resposta: 'ğŸ¤ Hip hop Ã© uma cultura que envolve mÃºsica, danÃ§a e arte visual. Letras sobre a realidade.' },
  { palavras: ['gospel'], resposta: 'ğŸ¤ Gospel Ã© mÃºsica religiosa cristÃ£, com letras de fÃ©, esperanÃ§a e louvor.' },
  { palavras: ['country'], resposta: 'ğŸ¤ Country Ã© mÃºsica ligada Ã  vida no campo, com instrumentos acÃºsticos.' },
  { palavras: ['rap'], resposta: 'ğŸ¤ Rap Ã© forma musical falada e ritmada, com letras fortes e crÃ­ticas.' },
];

// Curiosidades
const curiosidadesDesenho = [
  "Antes de existirem cadernos, as pessoas jÃ¡ pintavam nas cavernas, como nas pinturas de Caverna de Altamira, usando terra e carvÃ£o. ğŸ¨",
  "Leonardo da Vinci desenhava mÃ¡quinas voadoras sÃ©culos antes de o aviÃ£o existir. âœˆï¸"
];
const curiosidadesDanca = ["O balÃ© clÃ¡ssico nasceu nas cortes da Europa e ficou famoso com companhias como o Bolshoi Ballet. ğŸ©°"];
const curiosidadesTeatro = ["O teatro comeÃ§ou na GrÃ©cia Antiga, hÃ¡ mais de 2.500 anos, em festas dedicadas ao deus DionÃ­sio. ğŸ­"];
const curiosidadesEscultura = ["Michelangelo dizia que a escultura jÃ¡ estava escondida na pedra, e ele sÃ³ ajudava a revelar. ğŸ—¿"];
const curiosidadesArteGeral = ["O grafite transforma muros em galerias ao ar livre. ğŸ§±"];

// Unir todo o conhecimento
const conhecimento = [
  // EmoÃ§Ãµes
  { palavras: ['estou triste', 'triste', 'me sinto triste'], resposta: () => atividadesTriste[Math.floor(Math.random() * atividadesTriste.length)] },
  { palavras: ['estou feliz', 'feliz', 'alegre'], resposta: () => atividadesFeliz[Math.floor(Math.random() * atividadesFeliz.length)] },
  { palavras: ['estou entediado', 'tedio', 'sem nada'], resposta: () => atividadesTedio[Math.floor(Math.random() * atividadesTedio.length)] },
  { palavras: ['estou ansioso', 'ansioso', 'ansiedade'], resposta: () => atividadesAnsioso[Math.floor(Math.random() * atividadesAnsioso.length)] },
  { palavras: ['estou com raiva', 'raiva', 'zangado'], resposta: () => atividadesRaiva[Math.floor(Math.random() * atividadesRaiva.length)] },
  
  // Conceitos musicais
  ...conceitosMusicais,
  
  // Compositores
  ...compositores,
  
  // MÃºsica infantil
  ...musicaInfantil,
  
  // GÃªneros musicais
  ...generosMusicais,
  
  // Artistas plÃ¡sticos (jÃ¡ existentes no original, mantendo alguns)
  { palavras: ['leonardo da vinci', 'leonardo'], resposta: 'Leonardo da Vinci (1452â€“1519) foi um gÃªnio multifacetado do Renascimento. Pintor da â€œMona Lisaâ€ e de â€œA Ãšltima Ceiaâ€, tambÃ©m foi cientista, inventor e anatomista. ğŸ”' },
  { palavras: ['van gogh'], resposta: 'Vincent van Gogh (1853â€“1890) foi um pintor holandÃªs do pÃ³s-impressionismo. Criou obras vibrantes como â€œNoite Estreladaâ€. ğŸŒŸ' },
  { palavras: ['tarsila'], resposta: 'Tarsila do Amaral (1886â€“1973) foi uma das principais artistas do Modernismo brasileiro. Criadora de â€œAbaporuâ€. ğŸ¨' },
  { palavras: ['portinari'], resposta: 'Candido Portinari (1903â€“1962) foi um pintor brasileiro que retratou temas sociais e o povo trabalhador. ğŸ‘¨â€ğŸŒ¾' },
  
  // Resposta padrÃ£o
  { palavras: [], resposta: 'Que pergunta legal! Ainda nÃ£o sei responder essa, mas vocÃª pode perguntar sobre artistas (Tarsila, Van Gogh), mÃºsica (ritmo, melodias, compositores), gÃªneros musicais (MPB, rock, samba) ou me contar como vocÃª estÃ¡ se sentindo! ğŸ˜Š' }
];

// Lista de palavras bloqueadas
let palavrasBloqueadas = ['violÃªncia', 'guerra', 'tiro', 'sangue', 'briga', 'morte'];
let historicoPerguntas = [];

function removerAcentos(str) {
  return str.normalize('NFD').replace(/[\u0300-\u036f]/g, '');
}

function responderCuriosidade(perguntaNormalizada) {
  if (perguntaNormalizada.includes('desenho') || perguntaNormalizada.includes('pintura')) {
    return "ğŸ¨ " + curiosidadesDesenho[Math.floor(Math.random() * curiosidadesDesenho.length)];
  }
  if (perguntaNormalizada.includes('danÃ§a') || perguntaNormalizada.includes('danca')) {
    return "ğŸ’ƒ " + curiosidadesDanca[Math.floor(Math.random() * curiosidadesDanca.length)];
  }
  if (perguntaNormalizada.includes('teatro')) {
    return "ğŸ­ " + curiosidadesTeatro[Math.floor(Math.random() * curiosidadesTeatro.length)];
  }
  if (perguntaNormalizada.includes('escultura') || perguntaNormalizada.includes('estÃ¡tua')) {
    return "ğŸ—¿ " + curiosidadesEscultura[Math.floor(Math.random() * curiosidadesEscultura.length)];
  }
  return "âœ¨ " + curiosidadesArteGeral[Math.floor(Math.random() * curiosidadesArteGeral.length)];
}

function adicionarMensagem(tipo, texto) {
  const chat = document.getElementById('chatArea');
  const div = document.createElement('div');
  div.className = `mensagem ${tipo}`;
  if (tipo === 'resposta') {
    const textoEscapado = texto.replace(/'/g, "\\'");
    div.innerHTML = `<span>${texto} <button class="botao-audio" onclick="lerTexto('${textoEscapado}')"><i class="fas fa-volume-up"></i></button></span>`;
  } else {
    div.innerHTML = `<span>${texto}</span>`;
  }
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

function fazerPergunta(pergunta) {
  document.getElementById('perguntaInput').value = pergunta;
  enviarPergunta();
}

function enviarPergunta() {
  const input = document.getElementById('perguntaInput');
  const pergunta = input.value.trim();
  if (pergunta === '') return;

  const perguntaLower = pergunta.toLowerCase();
  for (let palavra of palavrasBloqueadas) {
    if (perguntaLower.includes(palavra)) {
      adicionarMensagem('pergunta', pergunta);
      adicionarMensagem('resposta', 'Ops! Essa pergunta nÃ£o posso responder. Que tal perguntar sobre arte, desenho ou mÃºsica? ğŸ–Œï¸');
      input.value = '';
      return;
    }
  }

  adicionarMensagem('pergunta', pergunta);
  const pincelFala = document.getElementById('pincelFala');
  pincelFala.innerText = 'Deixa eu pensar... ğŸ¤”';

  setTimeout(() => {
    const perguntaNormalizada = removerAcentos(perguntaLower);
    let respostaEncontrada = null;

    const palavrasCuriosidade = ['curiosidade', 'curiosidades', 'me conte algo', 'fale sobre'];
    if (palavrasCuriosidade.some(p => perguntaNormalizada.includes(p))) {
      respostaEncontrada = responderCuriosidade(perguntaNormalizada);
    } else {
      for (let item of conhecimento) {
        for (let palavra of item.palavras) {
          const palavraNormalizada = removerAcentos(palavra.toLowerCase());
          if (perguntaNormalizada.includes(palavraNormalizada)) {
            respostaEncontrada = item.resposta;
            break;
          }
        }
        if (respostaEncontrada) break;
      }
    }

    if (!respostaEncontrada) {
      respostaEncontrada = conhecimento.find(item => item.palavras.length === 0).resposta;
    }

    if (typeof respostaEncontrada === 'function') {
      respostaEncontrada = respostaEncontrada();
    }

    pincelFala.innerText = respostaEncontrada;
    adicionarMensagem('resposta', respostaEncontrada);
  }, 800);

  input.value = '';
}

function limparHistorico() {
  document.getElementById('chatArea').innerHTML = '';
  adicionarMensagem('resposta', 'HistÃ³rico limpo! Pode fazer novas perguntas.');
  historicoPerguntas = [];
}

function bloquearPalavra() {
  const palavra = prompt('Digite a palavra que deseja bloquear (ex: violÃªncia, guerra):');
  if (palavra && palavra.trim() !== '') {
    palavrasBloqueadas.push(palavra.trim().toLowerCase());
    alert(`Palavra "${palavra}" bloqueada!`);
  }
}

function iniciarPincel() {
  const chat = document.getElementById('chatArea');
  if (chat.children.length === 0) {
    adicionarMensagem('resposta', 'OlÃ¡! Eu sou o Pincel MÃ¡gico. Pode me perguntar sobre artistas, obras, me contar como se sente, ou pedir uma curiosidade!');
  }
}

document.getElementById('perguntaInput')?.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') enviarPergunta();
});
</script>
</body>
</html>
